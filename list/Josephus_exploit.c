#include<stdio.h>
#include<stdlib.h>


typedef struct Element 
{
	int value;
	struct Element *next;
}Element, *pointer;

pointer gemerate();
void show(pointer head);
void game(pointer head);
pointer get_rear(pointer head);

pointer get_rear(pointer head)
{
	pointer rear=head;
	while(rear->next!=head)
	{
		rear=rear->next;
	}
	return rear;
}

pointer generate()
{
	int num;
	int value;
	int index=1;
	printf("How may people are there in this circle:");scanf("%d",&num);getchar();
	if(num<1)
	{
		printf("the number of people should be at least 1!!\n");
		return 0;
	}
	pointer head=(pointer)malloc(sizeof(Element));
	pointer now=head;
	pointer new_=NULL;
	printf("enter No.%d's code:",index++);scanf("%d",&value);getchar();
	head->value=value;
	for(;index<=num;index++)
	{
		new_=(pointer)malloc(sizeof(Element));
		printf("enter No.%d's code:",index);scanf("%d",&value);getchar();
    	new_->value=value;
    	now->next=new_;
    	now=new_;
	}
	now->next=head;
	return head;
}

void show(pointer head)
{
	pointer temp=head;
	if(head!=NULL)
	{
		int index=1;
		printf("index                   code\n");
		while(1)
    	{
		     printf("  %d                       %d\n",index++,temp->value);
		     if(temp->next==head)
		     {
		     	break;
			 }
			 temp=temp->next;
    	}
	}
	
}

void game(pointer head)
{
	int m;
	int count=0;
	pointer temp=NULL;
	pointer previous=get_rear(head);
	printf("Please assign the count maximun!!:");scanf("%d",&m);getchar();
	while(head->next!=head)
	{
		printf("Report:count at %d where m is %d      code:%d\n",++count,m,head->value);
		if(count>=m)
		{
			temp=head;
			previous->next=temp->next;
			head=temp->next;
			count=0;
			m=temp->value;
			printf("delete code:%d  set m is %d\n",temp->value,m);
			free(temp);
		}
		else
		{
			previous=head;
	    	head=head->next;
		}
		
	}
	printf("final:             code:%d",head->value);
	free(head);
}

int main(void)
{
	pointer head=generate();
	printf("generated list:\n");
	show(head);
	game(head);
	return 0;
}
